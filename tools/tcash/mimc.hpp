#include "parsec/agent/client.hpp"
#include <libff/algebra/fields/bigint.hpp>
#include <libff/algebra/curves/alt_bn128/alt_bn128_pp.hpp>
#include <iostream> 

typedef libff::bigint<libff::alt_bn128_r_limbs> bigint_r;

namespace cbdc::parsec {
    class mimc {
        public:
            mimc(std::shared_ptr<logging::log> log);
        
            auto hash(std::string left, std::string right) -> std::string;

        private:
            std::shared_ptr<logging::log> m_log;
            static const size_t nRounds = 20; // rounds in circomlib mimcsponge = 220, just set 20 for now
            inline static std::array<bigint_r, 20> c = {
                bigint_r("0"),
                bigint_r("5292987596049301570289866113039212696588542638974459185646321376131196201357"), 
                bigint_r("5749697232220089582260420729173178774075903021593078073837725160928240165266"), 
                bigint_r("115759832252523717360015841034846976693069010798362596255935846008130106835318"), 
                bigint_r("80287568586501403812226701136492220608593455109980259299377761392913822342931"), 
                bigint_r("82137222858850572054918944569373958070698584631757886494151021485628536395584"), 
                bigint_r("95733370973027225653443698599627745333277222903619986787942690571947141794679"), 
                bigint_r("94782966109688012214448900448549121041754625885016483565436609323100911075883"), 
                bigint_r("24196348943429999811847395507010969018769853619997472912196725360885067035674"), 
                bigint_r("35114836225062743096073714676481317233998146864648445731399318838693788949143"), 
                bigint_r("52961622556887825934167700305110023348505554718030288012625939288621581611499"), 
                bigint_r("49816500093035887905725724392951749489246388657439382755340446297871629255859"), 
                bigint_r("61330147879685560956205222518829616283413951146521796281914388940459377044539"), 
                bigint_r("41559654224941361179830518418532617018799054949089100716689877295584797853553"), 
                bigint_r("24428110961002752762481971505787042006025073024186168488419541884965702189385"), 
                bigint_r("62486617173716904181462520888496931119299969607162595141055981903759186026963"), 
                bigint_r("62157994346436618332004815433550149912725153141356982098349628855394765098156"), 
                bigint_r("68693259748733834543868271981543314779056439975672553600837382559425704500577"), 
                bigint_r("15044286896785613910365040722545405819077060879657588823873812085241802249356"), 
                bigint_r("0"),
            };

            auto MiMC5Sponge(bigint_r _L, bigint_r _R, bigint_r _k) -> std::pair<bigint_r, bigint_r>;
    };
}
